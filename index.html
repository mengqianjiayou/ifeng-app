<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>凤凰新闻H5页面</title>
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <!--重置样式表-->
    <link rel="stylesheet" href="css/reset.min.css">
    <!--swiper插件-->
    <link rel="stylesheet" href="css/swiper.min.css">
    <!--样式表-->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
<!--流式布局 百分比布局 rem flexbox swiper ejs 动态绑定 iscroll.js 雪碧图 ajax跨域请求jsonp -->

<!--header-->
<header>
    <h1 class="i-logo">
        <a href="###">
            <img src="img/logo.png" alt="">
        </a>
    </h1>
</header>
<!--nav-->
<nav>
    <a class="i-link cur" href="###">头条</a>
    <a class="i-link" href="###">视频</a>
    <a class="i-link" href="###">财经</a>
    <a class="i-link" href="###">凤凰号</a>
    <a class="i-link" href="###">凤凰卫视</a>
</nav>
<!--focus-->
<section class="focus">
    <div class="swiper-container">
        <div class="swiper-wrapper"></div>
        <div class="swiper-pagination"></div>
    </div>
</section>
<!--main-->
<section class="main">
    <!--&lt;!&ndash;左图右文&ndash;&gt;
    <section class="item">
        <div class="i-pic">
            <a href="">
                <img src="images/img01.png" alt="">
            </a>
        </div>
        <div class="i-thumb">
            <div class="i-title">标题标题标题标题v标题标题标</div>
            <div class="i-des">
                <div class="i-time">5分钟前</div>
                <div class="i-num">
                    <span>1.1万</span>
                    <span class="i-icon"></span>
                    <span class="i-lable">专题</span>
                </div>
            </div>
        </div>
    </section>
    &lt;!&ndash;三小图&ndash;&gt;
    <section class="itemPics">
        <div class="i-title">
            <a href="###">标题</a>
        </div>
        <div class="pics">
            <a href="##">
                <img src="images/little01.png" alt="">
                <img src="images/little02.png" alt="">
                <img src="images/little03.png" alt="">
            </a>
        </div>
        <div class="i-des">
            <div class="i-info">
                <div class="i-soure">参考信息网</div>
                <div class="i-time">5分钟前</div>
            </div>
            <div class="i-num">
                <span>1.1万</span>
                <span class="i-icon"></span>
            </div>
        </div>
    </section>
    &lt;!&ndash;纯文字&ndash;&gt;
    <section class="itemPics itemTxt">
        <div class="i-title">
            <a href="###">标题</a>
        </div>
        <div class="i-des">
            <div class="i-info">
                <div class="i-soure">参考信息网</div>
                <div class="i-time">5分钟前</div>
            </div>
            <div class="i-num">
                <span>1.1万</span>
                <span class="i-icon"></span>
            </div>
        </div>
    </section>
    &lt;!&ndash;大图&ndash;&gt;
    <section class="itemPics">
        <div class="i-title">
            <a href="###">标题</a>
        </div>
        <div class="bigPics">
            <a href="##">
                <img src="images/little01.png" alt="">
                <span class="playbg"></span>
                <span class="playicon"></span>
                <span class="playtime">00'00"</span>
            </a>
        </div>
        <div class="i-des">
            <div class="i-info">
                <div class="i-soure">参考信息网</div>
                <div class="i-time">5分钟前</div>
            </div>
            <div class="i-num">
                <span>1.1万</span>
                <span class="i-icon"></span>
            </div>
        </div>
    </section>-->
</section>
</body>
</html>
<script charset="utf-8" src="js/swiper.min.js"></script>
<!--ejs插件-->
<script charset="utf-8" src="js/ejs.min.js"></script>
<!--zepto插件-->
<script charset="utf-8" src="js/zepto.min.js"></script>
<!--制造模板-->
<script charset="utf-8" id="focusTemplate" type="text/tempLate">
    <%$.each(focusTempData,function(index,item){%>
    <div class="swiper-slide">
        <a href="<%=item.link.weburl%>">
            <img src="<%=item.thumbnail%>" alt="">
            <span class="text"><%=item.title%></span>
            <span class="bg"></span>
        </a>
    </div>
    <%})%>
</script>
<script charset="utf-8" id="itemTemplate" type="text/template">

<% $.each(itemTempData,function(index,item){%>
    <%if (this.style.images){%>
        <%<!--三小图-->%>
            <section class="itemPics">
                <div class="i-title">
                    <a href="<%=item.link.weburl%>"><%=item.title%></a>
                </div>
                <div class="pics">
                    <a href="<%=item.link.weburl%>">
                        <img src="<%=item.style.images[0]%>" alt="">
                        <img src="<%=item.style.images[1]%>" alt="">
                         <img src="<%=item.style.images[2]%>" alt="">
                    </a>
                </div>
                <div class="i-des">
                    <div class="i-info">
                        <div class="i-soure"><%=item.source%></div>
                        <div class="i-time"><%=item.updateTime%></div>
                    </div>
                <div class="i-num">
                    <span><%=item.commentsall%></span>
                    <span class="i-icon"></span>
                </div>
             </div>
        </section>
<%}else if(this.type=='phvideo'){%>
    <%<!--大图-->%>
        <section class="itemPics">
            <div class="i-title">
                <a href="<%=item.link.weburl%>"><%=item.title%></a>
            </div>
            <div class="bigPics">
                <a href="<%=item.link.weburl%>">
                <img src="<%=item.thumbnail%>" alt="">
                    <span class="playbg"></span>
                    <span class="playicon"></span>
                <span class="playtime"></span>
            </a>
        </div>
        <div class="i-des">
            <div class="i-info">
                <div class="i-soure"><%=item.source%></div>
                <div class="i-time"></div>
            </div>
            <div class="i-num">
                <span><%=item.commentsall%></span>
                <span class="i-icon"></span>
            </div>
        </div>
    </section>
<%} else if(this.thumbnail){%>
    <%<!--左图右文-->%>
    <section class="item">
        <div class="i-pic">
            <a href="<%=item.link.weburl%>">
                <img src="<%=item.thumbnail%>" alt="">
            </a>
        </div>
        <div class="i-thumb">
            <div class="i-title"><%=item.title%></div>
            <div class="i-des">
                <div class="i-time"><%=item.updateTime%></div>
                <div class="i-num">
                    <span><%=item.commentsall%></span>
                    <span class="i-icon"></span>
                    <%if(item.style.attribute){%>
                    <span class="i-lable"><%=item.style.attribute%></span>
                    <%}%>
                </div>
            </div>
        </div>
    </section>
<%}else{%>
    <%<!--纯文字-->%>
    <section class="itemPics itemTxt">
        <div class="i-title">
            <a href="<%=item.link.weburl%>"><%=item.title%></a>
        </div>
        <div class="i-des">
            <div class="i-info">
                <div class="i-soure"><%=item.source%></div>
                <div class="i-time"><%=item.updateTime%></div>
            </div>
            <div class="i-num">
                <span><%=item.commentsall%></span>
                <span class="i-icon"></span>
            </div>
        </div>
    </section>
    <%}%>
<%})%>
</script>
<script>
    ;(function (desW) {
        var winW = document.documentElement.clientWidth,
            ratio = winW/desW;
        document.documentElement.style.fontSize = ratio *100 +'px';
    })(750);
    //swiper
    //绑定数据
    $.ajax({
        url:"http://api.iclient.ifeng.com/ClientNews?id=SYLB10,SYDT10&gv=5.4.0&os=ios&uid=8jWzrXDWQeep2Nw4AZYzmHxkbneHy4Fj&callback=jQuery191037427085312083364_1483258003039&_=1483258003040",
        type:'get',
        dataType:'jsonp',
        jsonp:'callback',
        success:bindHTML
    });
    function bindHTML(data) {
        for(var i =0;i<data.length;i++){
            if(data[i].type == 'focus'){
                var focusData = data[i].item;
            }else{
                var itemData = data[i].item;
                for(var j = 0;j<data[i].item.length;j++){
                    if(data[i].item[j].updateTime){
                    var nowTime = new Date();
                    var tarTime = new Date(data[i].item[j].updateTime);
                    var deffTime = (nowTime - tarTime)/1000;
                    var days =Math.floor(deffTime/60/60/24);
                    deffTime=deffTime -days*24*60*60;
                    var hours =Math.floor(deffTime/60/60);
                    deffTime=deffTime -hours*60*60;
                    var minutes =Math.floor(deffTime/60);
                    data[i].item[j].updateTime = (hours?hours +'小时':"")+(minutes?minutes +'分钟':'')+'前';
                        console.log(data[i].item[j].updateTime);
                    }}

            }
        }
        var focusHtml = $('#focusTemplate').html();
        var result = ejs.render(focusHtml,{focusTempData:focusData});
        $('.swiper-wrapper').html(result);
        //swiper
        var focusSwiper = new Swiper('.swiper-container',{
            loop:true,
            pagination:'.swiper-pagination',
            paginationType:'fraction',
            autoplay:4000,
            speed:1000,
            autoplayDisableOnInteraction:false
        });
        //main
        var itemHtml = $('#itemTemplate').html();
        var rest = ejs.render(itemHtml,{itemTempData:itemData});
        $('.main').html(rest);
    }

</script>